docker-build-and-publish:
    stage: docker-build-and-publish
    image: docker:latest
    before_script:
        - docker login -u "pektin" -p "${CI_REGISTRY_PASSWORD}"
    script:
        - if [ "$IMAGE_NAME"=="ui" ]; then sed -i "s|CI_COMMIT_SHORT_SHA|${CI_COMMIT_SHORT_SHA}|g" ./public/index.html
        - docker build --pull -t "pektin/${IMAGE_NAME}" .
        - docker push "pektin/${IMAGE_NAME}"
